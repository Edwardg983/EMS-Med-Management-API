{"version":3,"sources":["../../src/controller/medication.js"],"names":["config","db","api","post","req","res","newMed","name","body","expDate","quantity","box","truck","save","err","send","json","message","get","find","medications","params","console","log","distinct","medNames","sort","truckNames","boxNames","put","findById","id","medication","delete","status","remove","_id","Medication"],"mappings":"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","file":"medication.js","sourcesContent":["import mongoose from 'mongoose';\nimport { Router } from 'express'\nimport Medication from '../model/medication';\nimport MedicationName from '../model/medName';\nimport TruckName from '../model/truckName'\nimport BoxName from '../model/boxName'\nimport bodyParser from 'body-parser';\nimport passport from 'passport';\n\nimport { authenticate } from '../middleware/authMiddleware';\n\nexport default({ config, db }) => {\n  let api = Router();\n\n  // '/v1/medication/add' - Create\n  // This function will add a new med to the DB.\n  // TODO: I'VE DISABLED AUTH TEMP, DON'T FORGET TO ENABLE\n  api.post('/add', (req, res) => {\n    let newMed = new Medication();\n    newMed.name = req.body.name;\n    newMed.expDate = req.body.expDate;\n    newMed.quantity = req.body.quantity;\n    newMed.box = req.body.box;\n    newMed.truck = req.body.truck;\n\n    newMed.save(err => {\n      if (err){\n        res.send(err);\n      }\n      res.json({message: 'Medication saved successfully'});\n    });\n  });\n\n  // '/v1/medication' - Read\n  // Returns the entire DB.\n  api.get('/', (req,res) => {\n    Medication.find({}, (err, medications) => {\n      if (err) {\n        res.send(err);\n      }\n      res.json(medications);\n    });\n  });\n\n  // '/v1/medication/:id' - Read 1\n  // Finds a med by its id.\n  // api.get('/:id', (req, res) => {\n  //   Medication.findById(req.params.id, (err, medication) => {\n  //     if (err) {\n  //       res.send(err);\n  //     }\n  //     res.json(medication);\n  //   });\n  // });\n\n  // TODO: '/v1/medication/medUsed' - Reads med by name, truck, box (Believe this will be a MongoDB find operation). Look in the back of green UNH\n  // notebook for addtional notes on this function.\n  // AS OF 12/22/17 THIS FUNC WORKS.\n  // Returns all the meds by a specific name on a specific truck in a specific box.\n\n  api.get('/medUsed/:name/:truck/:box', (req, res) => {\n    Medication.find({name: req.params.name, truck: req.params.truck, box: req.params.box}, (err, medications) => {\n      if (err) {\n        res.send(err);\n      }\n      res.json(medications);\n    });\n  });\n\n  api.get('/getMedExists/:name/:truck/:box/:expDate', (req, res) => {\n    console.log(req.params.expDate);\n    Medication.find({name: req.params.name, truck: req.params.truck, box: req.params.box, expDate: req.params.expDate}, (err, medications) => {\n      if (err) {\n        res.send(err);\n      }\n      res.json(medications);\n    });\n  });\n\n  // Returns all the meds with the specified name in all the trucks. Will also indicate which box they are in.\n  api.get('/medUsed/:name', (req, res) => {\n    Medication.find({\"name\": req.params.name}, (err, medications) => {\n      if (err) {\n        res.send(err);\n      }\n      res.json(medications);\n    });\n  });\n\n  // '/v1/medication/getDistinctMedNames'\n  // Returns the distinct med names.\n  api.get('/getDistinctMedNames', (req, res) =>{\n    Medication.distinct((\"name\"), (err, medNames) => {\n      if (err) {\n        res.send(err);\n      }\n      medNames.sort();\n      res.json(medNames);\n    });\n  });\n\n  // '/v1/medication/getDistinctTruckNames'\n  // Returns the distinct med names.\n  api.get('/getDistinctTruckNames', (req, res) =>{\n    Medication.distinct((\"truck\"), (err, truckNames) => {\n      if (err) {\n        res.send(err);\n      }\n      truckNames.sort()\n      res.json(truckNames);\n    });\n  });\n\n  // '/v1/medication/getDistinctBoxNames'\n  // Returns the distinct med names.\n  api.get('/getDistinctBoxNames', (req, res) =>{\n    Medication.distinct((\"box\"), (err, boxNames) => {\n      if (err) {\n        res.send(err);\n      }\n      boxNames.sort()\n      res.json(boxNames);\n    });\n  });\n\n  // // '/v1/medication/:id' - Update\n  // // Updates a med.\n  // api.put('/:id', authenticate, (req, res) => {\n  //   Medication.findById(req.params.id, (err, medication) => {\n  //     if (err) {\n  //       res.send(err);\n  //     }\n  //     medication.name = req.body.name;\n  //     medication.expDate = req.body.expDate;\n  //     medication.quantity = req.body.quantity;\n  //     medication.box = req.body.box;\n  //     medication.truck = req.body.truck;\n  //\n  //     medication.save(err => {\n  //       if (err) {\n  //         res.send(err);\n  //       }\n  //       res.json({message: 'Medication info updated successfully'});\n  //     });\n  //   });\n  // });\n\n  // '/v1/medication/:id' - Update\n  // Updates a med.\n  // TODO: I'VE DISABLED AUTH TEMP, DON'T FORGET TO ENABLE\n  api.put('/update/:id', (req, res) => {\n    Medication.findById(req.params.id, (err, medication) => {\n      if (err) {\n        res.send(err);\n      }\n      medication.name = req.body.name;\n      medication.expDate = req.body.expDate;\n      medication.quantity = req.body.quantity;\n      medication.box = req.body.box;\n      medication.truck = req.body.truck;\n\n      medication.save(err => {\n        if (err) {\n          res.send(err);\n        }\n        res.json({message: 'Medication info updated successfully'});\n      });\n    });\n  });\n\n  // '/v1/medication/:id' - Delete\n  // Deletes a med from the DB\n  // TODO: I'VE DISABLED AUTH TEMP, DON'T FORGET TO ENABLE\n  api.delete('/:id', (req, res) => {\n    Medication.findById(req.params.id, (err, medication) => {\n      if (err) {\n        res.status(505).send(err);\n        return;\n      }\n      if (medication === null) {\n        res.status(404).send(err);\n        return;\n      }\n      Medication.remove({\n        _id: req.params.id\n      }, (err, Medication) => {\n        if (err) {\n          res.send(err);\n        }\n        res.json({message: \"Medication successfully deleted\"});\n      });\n    });\n  });\n\n\n  return api;\n\n}\n"]}